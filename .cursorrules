# Cursor Rules

## Instructions

- Record fixes for mistakes or corrections to avoid repetition in the `Lessons` section.
- Organize thoughts and plan steps before starting a task in the `Scratchpad` section.
- Clear old tasks if necessary.
- Use todo markers for progress tracking:
  - `[X]` Completed tasks
  - `[ ]` Pending tasks
- Update Scratchpad after completing subtasks.
- Reflect and plan after milestones for better task management.
- Always refer to Scratchpad before planning the next step.

## Lessons

1. Use `npx shadcn@latest add [component]` instead of `npx shadcn-ui@latest add [component]` when installing Shadcn UI components.
2. In Next.js 14+, page props params must be typed as a Promise. Example:
   ```typescript
   type tParams = Promise<{ id: string }>
   interface PageProps {
     params: tParams
   }
   ```
   Then await the params in the component:
   ```typescript
   export default async function Page(props: PageProps) {
     const { id } = await props.params
   }
   ```
3. Use `const session = await auth()` instead of `const session = await getServerSession(authOptions)` for Next.js authentication. The new `auth()` function is the recommended way to get the session in Next.js Auth v5.
4. When importing `useRouter` from 'next/navigation', the component must be marked as a client component using the `'use client'` directive at the top of the file, as this hook only works on the client side.

## Scratchpad
### 1. Mise en place du projet et configuration [ ]

- [x] Initialiser un projet Next.js 15 avec TypeScript
- [x] Structurer les dossiers et l’architecture (`app`, `components`, `lib`, `hooks`, `server`, etc.)
- [x] Configurer ESLint et Prettier
  - [x] ESLint configuré
  - [x] Prettier configuré
- [x] Installer et configurer les dépendances:
  - [x] Shadcn UI
  - [x] Lucide
  - [x] Zod (validation)
  - [x] Zustand (state management)
  - [x] Recharts (graphiques)
  - [x] Resend (emails)
  - [x] Uploadthing (upload)
  - [x] Prisma (ORM)
  - [x] PostgreSQL (base de données)
  - [x] next-auth@beta (authentification)
  - [x] Stripe (paiements)

### 2. Base de données et authentification [ ]

- [x] Configurer PostgreSQL (variable `DATABASE_URL` déjà définie)
- [x] Initialiser Prisma (`npx prisma init`)
- [x] Définir le schéma Prisma:
  - Modèle `User`
  - Modèle `Product`
  - Modèle `Category`
  - Modèle `Order`
  - Modèle `Review`
  - Modèle `Cart`
- [x] Générer les migrations (`npx prisma migrate dev`)
- [x] Créer un script de seed
- [x] Mettre en place NextAuth.js:
  - [x] Credentials (email/mot de passe)
  - [x] OAuth (Google, GitHub)
  - [x] JWT (callbacks, claims, rotation)
  - [x] Routes protégées (middleware)

### 3. Design system et fondations UI [ ]

- [x] Installer Shadcn et configurer le thème
- [x] Ajouter les composants de base:
  - Button, Input, Select, Card, Dialog, Dropdown Menu, Sheet, Tabs, Tooltip
  - Table, Skeleton, Toast/Toaster, Badge, Breadcrumb
- [x] Intégrer les icônes Lucide
- [ ] Header: Barre de recherche visible, icônes Mon compte + Panier (compteur)
- [ ] Bandeau USP en haut: "Livraison en moins de 24h à Dakar (hors dimanches/jours fériés)"
- [ ] Méga-menu catégories multi-niveaux (Promotion, Soin du visage, Corps & Bain, Maquillage, Parapharmacie, Cheveux, Parfumerie, Bébé & Enfant, Marques, Korean Beauty, Sexualité, Idées Cadeaux)
- [ ] Footer: blocs Catégories, Infos pratiques, Paiement sécurisé (logos), lien Blog, Conditions, Livraison, Politique cookies, mention Agence + bouton Retour en haut

### 4. Parcours client (front office) [ ]

- [x] Layout d’accueil:
  - [x] En-tête (logo, recherche, navigation)
  - [x] Pied de page (liens, réseaux)
- [x] Page d’accueil:
  - [x] Carrousel de bannières
  - [x] Produits récents / populaires
- [x] Catalogue produits:
  - [x] Catégories, filtres, tri, recherche
  - [x] Grille produits et pagination
- [ ] Page "Boutique" globale (listing agrégé)
- [ ] Pages Catégories (ex: Promotion, Cadeau & Promo, Soins du visage…) avec sous-catégories listées
- [ ] Pages Marques (archives par marque) avec tri & pagination
- [ ] Grille produits:
  - [ ] Devise CFA + formatage prix
  - [ ] Badge Promo + ancien prix barré
  - [ ] Bouton Ajouter au panier + Voir les détails depuis la grille
  - [ ] Sélecteur densité (16/32/48 par page)
  - [ ] Tri (Nom, Prix, Date, Mise en avant, Note, Pertinence, Aléatoire, Product ID)
  - [ ] Pagination profonde (Page 1 sur N)
- [ ] Page produit:
  - [x] Galerie images
  - [x] Infos (titre, prix, description) — stock à ajouter au schéma
  - [x] Bouton ajouter au panier
  - [x] Avis et notes (affichage)
  - [x] Produits similaires
- [ ] Panier:
  - [x] Ajout/suppression/mise à jour quantités
  - [x] Persistance (Zustand + storage)
  - [ ] État vide: message + CTA "Continuer les achats"
- [ ] Checkout:
  - Adresse et livraison
  - Paiement Stripe (SDK + webhooks)
  - Confirmation de commande
- [ ] Espace utilisateur:
  - Historique commandes
  - Profil et adresses
  - Wishlist

### 5. Tableau de bord administrateur (back office) [ ]

- [ ] Authentification/autorisation admin
- [ ] Vue d’ensemble (dashboard):
  - Cartes KPI (CA, commandes, clients, panier moyen)
  - Graphiques Recharts (revenus, vol. commandes, statuts)
  - Table des commandes récentes (tri/filtre/actions rapides)
- [ ] Gestion produits:
  - CRUD produits
  - Upload d’images (Uploadthing)
  - Catégories et stocks
- [ ] Gestion commandes:
  - Traitement, mise à jour statuts, remboursements
- [ ] Gestion utilisateurs:
  - Clients, rôles admin
  - Actions utilisateur
- [ ] Exports et rapports:
  - CSV/PDF, plage de dates

### 6. Emails et notifications [ ]

- [ ] Emails via Resend:
  - Confirmation de commande
  - Expédition
  - Réinitialisation mot de passe
- [ ] Notifications temps réel:
  - WebSocket/Server-Sent Events (si nécessaire)

### 7. Qualité, sécurité et performance [ ]

- [ ] Validation avec Zod (API et formulaires)
- [ ] Sécurité (rate limiting, headers, auth côté serveur)
- [ ] Optimisation performance:
  - Optimisation images
  - Cache (revalidate, ISR, CDN)
  - Optimisation API
- [ ] SEO et accessibilité (meta, sitemap, robots)
- [ ] Fil d’Ariane sur pages catalogue/catégories
- [ ] Titres H1/H2 cohérents (catégorie/produit)
- [ ] Recherche accessible sur toutes les pages catalogue

### 8. Tests et déploiement [ ]

- [ ] Tests unitaires, intégration, E2E
- [ ] Audit sécurité
- [ ] Déploiement prod:
  - Variables d’environnement
  - CI/CD
  - Monitoring et logs
  - Sauvegardes

### 9. Documentation [ ]

- [ ] Documentation API
- [ ] Guide utilisateur
- [ ] Guide administrateur
- [ ] Guide de déploiement

### 10. Parité Univers Cosmetix (structure & features) [ ]
- [ ] A. En-tête & navigation
  - [ ] Logo cliquable vers l’accueil
  - [ ] Barre de recherche visible
  - [ ] Icône/lien Mon compte, Panier (compteur)
  - [ ] Bandeau USP (Livraison <24h à Dakar)
  - [ ] Méga-menu catégories multi-niveaux (toutes familles listées)
- [ ] B. Pages principales
  - [ ] Accueil (bannières/hero promos + accès rapides)
  - [ ] Boutique (listing global)
  - [ ] Catégories (toutes familles)
  - [ ] Marques (archives par marque, tri, pagination)
  - [ ] Fiche produit (détails, ajouter au panier, description)
  - [ ] Panier (état vide + CTA)
  - [ ] Mon compte (connexion/inscription + zones post-login)
  - [ ] Livraison (délais Dakar <24h, régions 24–72h)
  - [ ] Conditions d’utilisations (paiements, délais)
- [ ] C. Listing produits (catégories & marques)
  - [ ] Grille prix en CFA, badge Promo, CTA Ajouter au panier & Voir détails
  - [ ] Tri complet (Nom, Prix, Date, Mise en avant, Note, Pertinence, Aléatoire, Product ID)
  - [ ] Sélecteur 16/32/48 produits par page
  - [ ] Pagination profonde
  - [ ] Sous-catégories listées par famille
- [ ] D. Fiche produit
  - [ ] Titre, prix (CFA), Ajouter au panier
  - [ ] Bloc Description
  - [ ] Lien Voir les détails depuis la grille
- [ ] E. Panier & Checkout
  - [ ] Panier vide + CTA Continuer les achats
  - [ ] Moyens de paiement locaux (Orange Money, Wave, CB) affichés et intégrés au checkout
  - [ ] Conditions de paiement documentées
- [ ] F. Compte client
  - [ ] Connexion / Inscription
  - [ ] Dashboard, Commandes, Adresses, Détails du compte, Déconnexion
- [ ] G. SEO & navigation secondaire
  - [ ] Fil d’Ariane
  - [ ] H1/H2 cohérents
  - [ ] Recherche accessible
- [ ] H. Marques & éditorial
  - [ ] Pages de marques avec tri/pagination
  - [ ] Cadeau & Promo: sous-page dédiée (tri + 48 par page)
- [ ] I. Footer
  - [ ] Catégories raccourcis (Cadeau & Promo, Cheveux, Corps & Bain, Maquillage, Parapharmacie)
  - [ ] Infos pratiques (Nos Marques, Mon compte, Blog, Conditions, Livraison, Politique cookies)
  - [ ] Logos Paiement sécurisé (Orange Money, Wave, Visa, Mastercard…)
  - [ ] Mention Agence + Retour en haut
- [ ] J. Spécificités marché (SN)
  - [ ] Devise CFA sur tout le site (formatage global)
  - [ ] Promesse logistique (<24h Dakar / 24–72h régions)
  - [ ] Moyens de paiement locaux au checkout