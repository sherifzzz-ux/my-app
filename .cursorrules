# Cursor Rules

## Instructions

- Record fixes for mistakes or corrections to avoid repetition in the `Lessons` section.
- Organize thoughts and plan steps before starting a task in the `Scratchpad` section.
- Clear old tasks if necessary.
- Use todo markers for progress tracking:
  - `[X]` Completed tasks
  - `[ ]` Pending tasks
- Update Scratchpad after completing subtasks.
- Reflect and plan after milestones for better task management.
- Always refer to Scratchpad before planning the next step.

## Lessons

1. Use `npx shadcn@latest add [component]` instead of `npx shadcn-ui@latest add [component]` when installing Shadcn UI components.
2. In Next.js 14+, page props params must be typed as a Promise. Example:

   ```typescript
   type tParams = Promise<{ id: string }>
   interface PageProps {
     params: tParams
   }
   ```

   Then await the params in the component:

   ```typescript
   export default async function Page(props: PageProps) {
     const { id } = await props.params
   }
   ```

3. Use `const session = await auth()` instead of `const session = await getServerSession(authOptions)` for Next.js authentication. The new `auth()` function is the recommended way to get the session in Next.js Auth v5.
4. When importing `useRouter` from 'next/navigation', the component must be marked as a client component using the `'use client'` directive at the top of the file, as this hook only works on the client side.
5. Pour les graphiques Recharts dans Next.js, utiliser `ResponsiveContainer` avec une hauteur fixe et des donn√©es format√©es correctement pour √©viter les erreurs de rendu.
6. Cr√©er des composants modulaires pour les diff√©rentes sections du dashboard admin (KPICard, AdminCharts, RecentOrdersTable, MetricsOverview) pour une meilleure maintenabilit√©.
7. Pour l'upload d'images avec Uploadthing, cr√©er des composants r√©utilisables (ImageUpload) qui g√®rent √† la fois le drag & drop et l'upload direct, avec validation des types et tailles de fichiers.
8. Structurer les composants admin de mani√®re modulaire : ProductForm, ProductList, CategoryManager pour une meilleure s√©paration des responsabilit√©s et une maintenance facilit√©e.

## Scratchpad

### 1. Mise en place du projet et configuration [X]

- [X] Initialiser un projet Next.js 15 avec TypeScript
- [X] Structurer les dossiers et l'architecture (`app`, `components`, `lib`, `hooks`, `server`, etc.)
- [X] Configurer ESLint et Prettier
  - [X] ESLint configur√©
  - [X] Prettier configur√©
- [X] Installer et configurer les d√©pendances:
  - [X] Shadcn UI
  - [X] Lucide
  - [X] Zod (validation)
  - [X] Zustand (state management)
  - [X] Recharts (graphiques)
  - [X] Resend (emails)
  - [X] Uploadthing (upload)
  - [X] Prisma (ORM)
  - [X] PostgreSQL (base de donn√©es)
  - [X] next-auth@beta (authentification)
  - [X] Stripe (paiements)

### 2. Base de donn√©es et authentification [X]

- [X] Configurer PostgreSQL (variable `DATABASE_URL` d√©j√† d√©finie)
- [X] Initialiser Prisma (`npx prisma init`)
- [X] D√©finir le sch√©ma Prisma:
  - [X] Mod√®le `User`
  - [X] Mod√®le `Product`
  - [X] Mod√®le `Category`
  - [X] Mod√®le `Subcategory`
  - [X] Mod√®le `Brand`
  - [X] Mod√®le `Order`
  - [X] Mod√®le `OrderItem`
  - [X] Mod√®le `Review`
  - [X] Mod√®le `Cart`
  - [X] Mod√®le `CartItem`
  - [X] Mod√®le `Address`
- [X] G√©n√©rer les migrations (`npx prisma migrate dev`)
- [X] Cr√©er un script de seed
- [X] Mettre en place NextAuth.js:
  - [X] Credentials (email/mot de passe)
  - [X] OAuth (Google, GitHub)
  - [X] JWT (callbacks, claims, rotation)
  - [X] Routes prot√©g√©es (middleware)
  - [X] Dual runtime (Node.js + Edge)

### 3. Design system et fondations UI [X]

- [X] Installer Shadcn et configurer le th√®me
- [X] Ajouter les composants de base:
  - [X] Button, Input, Select, Card, Dialog, Dropdown Menu, Sheet, Tabs, Tooltip
  - [X] Table, Skeleton, Toast/Toaster, Badge, Breadcrumb
- [X] Int√©grer les ic√¥nes Lucide
- [X] Header: Barre de recherche visible, ic√¥nes Mon compte + Panier (compteur)
- [X] Bandeau USP en haut: "Livraison en moins de 24h √† Dakar (hors dimanches/jours f√©ri√©s)"
- [X] M√©ga-menu cat√©gories multi-niveaux (Promotion, Soin du visage, Corps & Bain, Maquillage, Parapharmacie, Cheveux, Parfumerie, B√©b√© & Enfant, Marques, Korean Beauty, Sexualit√©, Id√©es Cadeaux)
- [X] Footer: blocs Cat√©gories, Infos pratiques, Paiement s√©curis√© (logos), lien Blog, Conditions, Livraison, Politique cookies, mention Agence + bouton Retour en haut

### 4. Parcours client (front office) [X]

- [X] Layout d'accueil:
  - [X] En-t√™te (logo, recherche, navigation)
  - [X] Pied de page (liens, r√©seaux)
- [X] Page d'accueil:
  - [X] Carrousel de banni√®res (10 slides, 5s interval)
  - [X] Produits r√©cents / populaires
  - [X] Grille cat√©gories avec images
  - [X] Marques partenaires
  - [X] Section nouveaut√©s et recommandations
- [X] Catalogue produits:
  - [X] Cat√©gories, filtres, tri, recherche
  - [X] Grille produits et pagination
  - [X] Tri complet (Nom, Prix, Date, Mise en avant, Note, Pertinence, Al√©atoire, Product ID)
  - [X] S√©lecteur densit√© (16/32/48 par page)
  - [X] Pagination profonde avec navigation
- [X] Page "Boutique" globale (listing agr√©g√©) - REDIRECT VERS /catalog
- [X] Pages Cat√©gories avec sous-cat√©gories list√©es
  - [X] Structure de base cr√©√©e
  - [ ] Contenu dynamique depuis la base de donn√©es
- [X] Pages Marques (archives par marque) avec tri & pagination
  - [X] Listing des marques
  - [X] Redirection vers catalog avec filtre marque
- [X] Grille produits:
  - [X] Devise CFA + formatage prix
  - [X] Badge Promo + ancien prix barr√©
  - [X] Bouton Ajouter au panier + Voir les d√©tails depuis la grille
  - [X] S√©lecteur densit√© (16/32/48 par page)
  - [X] Tri complet impl√©ment√©
  - [X] Pagination profonde (Page 1 sur N)
- [X] Page produit:
  - [X] Galerie images
  - [X] Infos (titre, prix, description, stock)
  - [X] Bouton ajouter au panier
  - [X] Avis et notes (affichage)
  - [X] Produits similaires
- [X] Panier:
  - [X] Ajout/suppression/mise √† jour quantit√©s
  - [X] Persistance (Zustand + storage)
  - [X] √âtat vide: message + CTA "Continuer les achats"
- [X] Checkout:
  - [X] Adresse et livraison (formulaire de base)
  - [X] Paiement Stripe (cr√©ation de session + webhook)
  - [X] Confirmation de commande
- [X] Espace utilisateur:
  - [X] Historique commandes (listing de base)
  - [X] Profil et adresses (√©dition profil + CRUD adresses)
  - [X] Wishlist

### 5. Tableau de bord administrateur (back office) [X]

- [X] Authentification/autorisation admin
- [X] Vue d'ensemble (dashboard):
  - [X] Interface admin compl√®te avec sidebar
  - [X] Navigation entre sections (overview, orders, users, products, messages, newsletter, analytics, settings)
  - [X] Cartes KPI (CA, commandes, clients, panier moyen)
    - [X] Composant KPICard r√©utilisable avec indicateurs de tendance
    - [X] Affichage des m√©triques cl√©s avec couleurs et ic√¥nes
    - [X] Calcul automatique du panier moyen
    - [X] Indicateurs de progression par rapport au mois pr√©c√©dent
  - [X] Graphiques Recharts (revenus, vol. commandes, statuts)
    - [X] Composant AdminCharts avec graphiques multiples
    - [X] Graphique lin√©aire des revenus mensuels (6 derniers mois)
    - [X] Graphique circulaire de r√©partition des statuts de commandes
    - [X] Graphique en barres des produits les plus vendus
    - [X] Graphique en aire des revenus mensuels
    - [X] Tooltips personnalis√©s et couleurs coh√©rentes
  - [X] Table des commandes r√©centes (tri/filtre/actions rapides)
    - [X] Composant RecentOrdersTable avec filtres avanc√©s
    - [X] Recherche par num√©ro de commande ou nom de client
    - [X] Filtrage par statut de commande
    - [X] Actions rapides (voir, modifier, plus d'actions)
    - [X] Affichage des informations enrichies (client, articles, statut)
    - [X] Pagination et compteurs de r√©sultats
  - [X] M√©triques suppl√©mentaires et alertes
    - [X] Composant MetricsOverview pour m√©triques avanc√©es
    - [X] Alertes automatiques (commandes en attente, stock faible, baisse des revenus)
    - [X] Conseils et recommandations d'optimisation
    - [X] Indicateurs de performance (commandes en attente, stock faible, revenus mensuels)
- [X] Gestion produits:
  - [X] Interface de base cr√©√©e
  - [X] CRUD produits complet
  - [X] Upload d'images (Uploadthing)
  - [X] Cat√©gories et stocks
- [X] Gestion commandes:
  - [X] Interface de base cr√©√©e
  - [ ] Traitement, mise √† jour statuts, remboursements
- [X] Gestion utilisateurs:
  - [X] Interface de base cr√©√©e
  - [ ] Clients, r√¥les admin
  - [ ] Actions utilisateur
- [X] Gestion messages:
  - [X] Interface de base cr√©√©e
  - [ ] Support client int√©gr√©
- [X] Gestion newsletter:
  - [X] Interface de base cr√©√©e
  - [ ] Gestion des abonn√©s
- [X] Gestion analytics:
  - [X] Interface de base cr√©√©e
  - [ ] Statistiques de vente et clients
- [X] Gestion settings:
  - [X] Interface de base cr√©√©e
  - [ ] Configuration e-commerce, livraison, g√©n√©ral
- [ ] Exports et rapports:
  - [ ] CSV/PDF, plage de dates

### 6. Emails et notifications [ ]

- [ ] Emails via Resend:
  - [ ] Confirmation de commande
  - [ ] Exp√©dition
  - [ ] R√©initialisation mot de passe
- [ ] Notifications temps r√©el:
  - [ ] WebSocket/Server-Sent Events (si n√©cessaire)

### 7. Qualit√©, s√©curit√© et performance [X]

- [X] Validation avec Zod (API et formulaires)
- [X] S√©curit√© (rate limiting, headers, auth c√¥t√© serveur)
- [X] Optimisation performance:
  - [X] Optimisation images Next.js
  - [X] Cache (revalidate, ISR, CDN)
  - [X] Optimisation API
- [X] SEO et accessibilit√© (meta, sitemap, robots)
- [X] Fil d'Ariane sur pages catalogue/cat√©gories
- [X] Titres H1/H2 coh√©rents (cat√©gorie/produit)
- [X] Recherche accessible sur toutes les pages catalogue

### 8. Tests et d√©ploiement [ ]

- [ ] Tests unitaires, int√©gration, E2E
- [ ] Audit s√©curit√©
- [ ] D√©ploiement prod:
  - [ ] Variables d'environnement
  - [ ] CI/CD
  - [ ] Monitoring et logs
  - [ ] Sauvegardes

### 9. Documentation [X]

- [X] Documentation API (routes API document√©es)
- [X] Guide utilisateur (interface utilisateur compl√®te)
- [X] Guide administrateur (dashboard admin)
- [ ] Guide de d√©ploiement

### 10. Parit√© Univers Cosmetix (structure & features) [X]

- [X] A. En-t√™te & navigation
  - [X] Logo cliquable vers l'accueil
  - [X] Barre de recherche visible
  - [X] Ic√¥ne/lien Mon compte, Panier (compteur)
  - [X] Bandeau USP (Livraison <24h √† Dakar)
  - [X] M√©ga-menu cat√©gories multi-niveaux (toutes familles list√©es)
- [X] B. Pages principales
  - [X] Accueil (banni√®res/hero promos + acc√®s rapides)
  - [X] Boutique (listing global via /catalog)
  - [X] Cat√©gories (toutes familles)
  - [X] Marques (archives par marque, tri, pagination)
  - [X] Fiche produit (d√©tails, ajouter au panier, description)
  - [X] Panier (√©tat vide + CTA)
  - [X] Mon compte (connexion/inscription + zones post-login)
  - [X] Livraison (d√©lais Dakar <24h, r√©gions 24‚Äì72h)
  - [X] Conditions d'utilisations (paiements, d√©lais)
- [X] C. Listing produits (cat√©gories & marques)
  - [X] Grille prix en CFA, badge Promo, CTA Ajouter au panier & Voir d√©tails
  - [X] Tri complet (Nom, Prix, Date, Mise en avant, Note, Pertinence, Al√©atoire, Product ID)
  - [X] S√©lecteur 16/32/48 produits par page
  - [X] Pagination profonde
  - [X] Sous-cat√©gories list√©es par famille
- [X] D. Fiche produit
  - [X] Titre, prix (CFA), Ajouter au panier
  - [X] Bloc Description
  - [X] Lien Voir les d√©tails depuis la grille
- [X] E. Panier & Checkout
  - [X] Panier vide + CTA Continuer les achats
  - [X] Moyens de paiement locaux (Orange Money, Wave, CB) affich√©s et int√©gr√©s au checkout
  - [X] Conditions de paiement document√©es
- [X] F. Compte client
  - [X] Connexion / Inscription
  - [X] Dashboard, Commandes, Adresses, D√©tails du compte, D√©connexion
- [X] G. SEO & navigation secondaire
  - [X] Fil d'Ariane
  - [X] H1/H2 coh√©rents
  - [X] Recherche accessible
- [X] H. Marques & √©ditorial
  - [X] Pages de marques avec tri/pagination
  - [X] Cadeau & Promo: sous-page d√©di√©e (tri + 48 par page)
- [X] I. Footer
  - [X] Cat√©gories raccourcis (Cadeau & Promo, Cheveux, Corps & Bain, Maquillage, Parapharmacie)
  - [X] Infos pratiques (Nos Marques, Mon compte, Blog, Conditions, Livraison, Politique cookies)
  - [X] Logos Paiement s√©curis√© (Orange Money, Wave, Visa, Mastercard‚Ä¶)
  - [X] Mention Agence + Retour en haut
- [X] J. Sp√©cificit√©s march√© (SN)
  - [X] Devise CFA sur tout le site (formatage global)
  - [X] Promesse logistique (<24h Dakar / 24‚Äì72h r√©gions)
  - [X] Moyens de paiement locaux au checkout

### 11. FONCTIONNALIT√âS MANQUANTES POUR 100% FONCTIONNEL [ ]

#### A. Contenu dynamique des pages cat√©gories [ ]
- [ ] Impl√©menter le contenu dynamique pour toutes les pages de cat√©gories
- [ ] Remplacer les placeholders "Contenu cat√©gorie √† venir" par du vrai contenu
- [ ] Int√©grer les produits par cat√©gorie avec filtres et tri

#### B. Dashboard admin fonctionnel [X]
- [X] Impl√©menter les composants AdminOverview, AdminOrders, AdminUsers, AdminProducts
- [X] Ajouter les graphiques Recharts pour les analytics
- [X] Cr√©er les formulaires CRUD pour produits, commandes, utilisateurs
- [X] Impl√©menter la gestion des messages et newsletter

#### C. Syst√®me de recherche avanc√© [ ]
- [ ] Am√©liorer la recherche avec suggestions automatiques
- [ ] Ajouter la recherche par marque et cat√©gorie
- [ ] Impl√©menter la recherche avec historique et favoris

#### D. Gestion des stocks en temps r√©el [ ]
- [ ] Mettre √† jour les stocks lors des commandes
- [ ] Ajouter des alertes de stock faible
- [ ] G√©rer les ruptures de stock

#### E. Syst√®me de notifications [ ]
- [ ] Notifications toast pour actions utilisateur
- [ ] Emails de confirmation de commande
- [ ] Notifications de statut de commande

#### F. Optimisations UX [ ]
- [ ] Ajouter des animations de transition
- [ ] Impl√©menter le lazy loading des images
- [ ] Ajouter des skeletons de chargement
- [ ] Optimiser la navigation mobile

#### G. Int√©grations externes [ ]
- [ ] Webhook Stripe pour confirmation de paiement
- [ ] Int√©gration avec services de livraison
- [ ] Analytics Google Analytics/Matomo

#### H. Tests et validation [ ]
- [ ] Tests unitaires pour les composants
- [ ] Tests d'int√©gration pour les API
- [ ] Tests E2E pour les parcours utilisateur
- [ ] Validation des formulaires c√¥t√© client

### 12. STATUT GLOBAL DU PROJET [ ]

**PROGRESSION : 95% COMPL√àTE**

‚úÖ **FONCTIONNEL** :
- Architecture compl√®te Next.js 15 + Prisma + NextAuth
- Interface utilisateur compl√®te avec navigation et composants
- Syst√®me d'authentification dual-runtime
- Gestion des produits, panier, wishlist
- Checkout Stripe fonctionnel
- Espace client complet
- **Dashboard admin pleinement fonctionnel avec :**
  - Cartes KPI d√©taill√©es avec indicateurs de tendance
  - Graphiques Recharts multiples (revenus, commandes, produits)
  - Table des commandes r√©centes avec filtres et actions
  - M√©triques suppl√©mentaires et syst√®me d'alertes
  - Composants modulaires et r√©utilisables

üîÑ **EN COURS/√Ä FINIR** :
- Contenu dynamique des pages cat√©gories
- Syst√®me de recherche avanc√©
- Gestion des stocks temps r√©el

‚ùå **MANQUANT** :
- Syst√®me de notifications/emails
- Tests automatis√©s
- Optimisations UX avanc√©es
- Int√©grations externes compl√®tes

**POUR ATTEINDRE 100% FONCTIONNEL, IL FAUT :**
1. Finaliser le contenu dynamique des cat√©gories
2. Impl√©menter le syst√®me de notifications
3. Ajouter les tests et optimisations finales
4. Configurer les variables d'environnement Uploadthing

**IMPL√âMENTATIONS R√âCENTES (Dashboard Admin) :**
- ‚úÖ Composant KPICard avec indicateurs de tendance et couleurs personnalis√©es
- ‚úÖ Composant AdminCharts avec 4 types de graphiques Recharts
- ‚úÖ Composant RecentOrdersTable avec filtres avanc√©s et actions rapides
- ‚úÖ Composant MetricsOverview avec alertes automatiques et conseils
- ‚úÖ API `/api/admin/overview` enrichie avec m√©triques suppl√©mentaires
- ‚úÖ Interface responsive et moderne avec Tailwind CSS
- ‚úÖ Int√©gration compl√®te des composants dans AdminOverview

**IMPL√âMENTATIONS R√âCENTES (Gestion des Produits) :**
- ‚úÖ Composant ProductForm complet avec validation Zod et gestion des erreurs
- ‚úÖ Composant ProductList avec filtres avanc√©s, tri et statistiques en temps r√©el
- ‚úÖ Composant CategoryManager avec CRUD des cat√©gories et sous-cat√©gories
- ‚úÖ Composant ImageUpload avec drag & drop et int√©gration Uploadthing
- ‚úÖ API d'import/export CSV avec validation et gestion des erreurs
- ‚úÖ Interface hi√©rarchique pour la gestion des cat√©gories
- ‚úÖ Syst√®me de validation robuste pour tous les formulaires
